---
import { SITE_TITLE, SITE_DESCRIPTION, SITE_IMG } from "../consts/consts";
import {
  generateAdventCalendar,
  weekdayNames,
  type Post,
} from "../functions/calendar";
import Layout from "./Layout.astro";

export interface Props {
  title: string;
  year: number;
  posts: Post[];
  endDate?: number;
}

const { year, title, endDate, posts } = Astro.props;

const yearString = year.toString();
const calendarWeeks = generateAdventCalendar(posts, year, endDate);
---

<Layout
  title={`Advent Calendar ${yearString} - ${title} - ${SITE_TITLE}`}
  description={SITE_DESCRIPTION}
  image={SITE_IMG}
  maxWidth={1200}
>
  <div class="blog-header">
    <h1>Advent Calendar {yearString}<br />{title}</h1>
  </div>

  <div class="calendar-container">
    <table class="calendar">
      <thead>
        <tr>
          {
            weekdayNames.map((dayName) => (
              <th class="day-header" scope="col">
                {dayName}
              </th>
            ))
          }
        </tr>
      </thead>

      <tbody>
        {
          calendarWeeks.map((week) => (
            <tr class="calendar-week">
              {week.days.map((dayData) => (
                <td
                  class:list={[
                    "calendar-day",
                    { "other-month": !dayData.isCurrentMonth },
                    { "advent-day": dayData.isAdventDay },
                    { "has-post": dayData.post },
                  ]}
                >
                  {dayData.post ? (
                    <a
                      href={dayData.post.url}
                      class:list={["day-post", "day-post-link"]}
                    >
                      <div class="day-number">{dayData.day}</div>
                      <div class="day-post-title">{dayData.post.title}</div>
                    </a>
                  ) : (
                    <div class:list={["day-post"]}>
                      <div class="day-number">{dayData.day}</div>
                    </div>
                  )}
                </td>
              ))}
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</Layout>

<style>
  .blog-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .blog-header h1 {
    font-size: var(--text-4xl);
    color: var(--color-accent);
    margin-bottom: 0.5rem;
  }

  .calendar {
    width: 100%;
    background: var(--color-surface);
    border-radius: var(--radius-md);
    border: 2px solid var(--color-border);
    overflow: hidden;
  }

  .calendar thead {
    background: var(--color-accent);
    color: white;
  }

  .day-header {
    padding: 1rem;
    text-align: center;
    font-weight: var(--font-weight-bold);
    font-size: var(--text-sm);
    border-right: 1px solid rgba(255, 255, 255, 0.2);
  }

  .day-header:last-child {
    border-right: none;
  }

  .calendar-week {
    border-bottom: 2px solid var(--color-border);
  }

  .calendar-week:last-child {
    border-bottom: none;
  }

  .calendar-day {
    vertical-align: top;
    height: 160px;
    width: 200px;
    border-right: 2px solid var(--color-border);
    transition: var(--transition-fast);
  }

  .calendar-day.other-month {
    background-color: var(--color-surface);
  }

  .calendar-day.advent-day {
    background-color: rgba(59, 130, 246, 0.08);
  }
  .calendar-day.has-post:hover,
  .calendar-day.has-post:focus-within {
    background-color: rgba(15, 99, 234, 0.18);
  }

  .day-number {
    font-weight: var(--font-weight-bold);
    font-size: var(--text-base);
    margin-bottom: 0.5rem;
    line-height: 1;
    color: var(--color-muted);
  }

  .day-post {
    padding: 0.5rem;
  }

  .day-post-link {
    text-decoration: none;
    color: inherit;
    display: block;
    width: 100%;
    height: 100%;
  }

  .day-post-title {
    font-size: var(--text-sm);
    line-height: var(--line-height-tight);
    font-weight: var(--font-weight-semibold);
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 5;
    text-overflow: ellipsis;
  }

  @container (width < 600px) {
    .blog-header {
      margin-bottom: 2rem;
    }

    .blog-header h1 {
      font-size: var(--text-h1);
    }

    .calendar-subtitle {
      font-size: var(--text-h2);
    }

    .calendar-day {
      height: 100px;
      padding: 0.5rem;
    }

    .day-header {
      padding: 0.75rem 0.5rem;
      font-size: var(--text-xs);
    }

    .day-post-title {
      font-size: var(--text-xs);
      -webkit-line-clamp: 2;
    }

    .day-number {
      font-size: var(--text-sm);
    }

    .day-placeholder {
      bottom: 0.5rem;
      left: 0.5rem;
      right: 0.5rem;
    }
  }

  @container (width < 480px) {
    .calendar-day {
      min-height: 80px;
      height: 80px;
      padding: 0.25rem;
    }

    .day-header {
      padding: 0.5rem 0.25rem;
    }

    .day-post-title {
      display: none;
    }

    .day-placeholder {
      bottom: 0.25rem;
      left: 0.25rem;
      right: 0.25rem;
    }
  }
</style>
